name: Auto Push to Stage on Release Commit
on:
  push:
    branches:
      - main
jobs:
    release-to-stage:
      if: contains(github.event.head_commit.message, 'release:')
      runs-on: ubuntu-latest

      steps:
        - name: Checkout repo
          uses: actions/checkout@v4.2.2

        - name: Set up Git
          run: |
            git config user.name "GitHub Actions"
            git config user.email "actions@github.com"

        - name: Push main to stage
          run: |
            git fetch origin
            git checkout -b stage origin/stage || git checkout -b stage
            git merge origin/main --no-edit
            git push origin stage